FROM centos:7

ENV HOME /root
WORKDIR ${HOME}

RUN yum install -y --setopt=tsflags=nodocs \
    yum-utils \
 && rpmkeys --import file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7 \
 && yum install -y --setopt=tsflags=nodocs \
    centos-release-scl-rh \
    epel-release \
    wget \
 && wget -O /etc/yum.repos.d/home:pdi.repo https://download.opensuse.org/repositories/home:pdi/CentOS_7/home:pdi.repo \
 && rpmkeys --import file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7 \
 && yum update -y --setopt=tsflags=nodocs \
 && yum upgrade -y --setopt=tsflags=nodocs \
 && yum install -y --setopt=tsflags=nodocs \
    bison \
    bsdtar \
    devtoolset-6-gcc \
    devtoolset-6-gcc-c++ \
    devtoolset-6-gcc-gfortran \
    file \
    findutils \
    flex \
    freeglut-devel \
    gettext \
    groff-base \
    hwloc-devel \
    make \
    openmpi3-devel \
    perl \
    python-devel \
    python3-devel \
    python3-pip \
    PyYAML \
    rsync \
    scl-utils \
    sudo \
    tar \
    unzip \
    which \
 && pip3 install pyyaml \
 && yum clean all -y --enablerepo='*' \
 && rm -f /*.log ${HOME}/* \
 && echo -e 'module load mpi\nexport OMPI_MCA_rmaps_base_oversubscribe=1' > /etc/profile.d/zzz_enable_mpi.sh \
 && echo 'source scl_source enable devtoolset-6' > /etc/profile.d/zzz_enable_devtoolset6.sh \
 && echo -e '/usr/local/lib\n/usr/local/lib64' > /etc/ld.so.conf.d/local.conf \
 && ldconfig

SHELL ["/bin/bash", "-l", "-c"]
